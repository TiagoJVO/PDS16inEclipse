grammar org.pds16.Pds16asm with org.eclipse.xtext.common.Terminals
generate pds16asm "http://www.pds16.org/Pds16asm"

PDS16ASM:
	instuctions+=Instructions*;

Instructions:
	Load | Store | Aritmetica | Logica | Jump | Comment;


Load: LdImmediate | LdDirect | LdIndexed | LdBasedIndexed ;
Store: StDirect | StIndexed | StBasedIndexed;
Aritmetica: AddRegisters | AddConstant | SubRegisters | SubConstant;
Logica: ANL | ORL | XRL | NOT | SHL | SHR | RR | RC;
Jump: JumpOp;

/*********************** Load **********************/
LdImmediate: ('ldi' |'ldih')  Immediate;

LdDirect: ('ld' | 'ldb') Direct;

LdIndexed: ('ld' | 'ldb') Indexed;

LdBasedIndexed: ('ld' | 'ldb') BasedIndexed;
/***************************************************/

/*********************** Store *********************/
StDirect: ('st' | 'stb') Direct ;

StIndexed: ('st' | 'stb') Indexed;

StBasedIndexed: ('st' | 'stb') BasedIndexed ;
/***************************************************/

/******************** Aritmetica *******************/
AddRegisters: ('add' | 'addf' | 'adc' | 'adcf') operationsWithTreeRegisters ;

AddConstant: ('add' | 'addf' | 'adc' | 'adcf') operationsWithConstant;
//É possivel simplificar para esta maneira!! É legivel??
//Add: ('add' | 'addf' | 'adc' | 'adcf') (operationsWithConstant | operationsWithRegisters);

SubRegisters: ('sub' | 'subf' | 'sbb' | 'sbbf') operationsWithTreeRegisters ;

SubConstant: ('sub' | 'subf' | 'sbb' | 'sbbf') operationsWithConstant ;
/***************************************************/

/**************************** Logica **********************************/
ANL: ('anl' | 'anlf') operationsWithTreeRegisters;

ORL: ('orl' | 'orlf') operationsWithTreeRegisters;

XRL: ('xrl' | 'xrlf') operationsWithTreeRegisters;

NOT: ('not' | 'notf') operationWithTwoRegisters;

SHL: 'shl' operationShift;

SHR: 'shr' operationShift;

RR: ('rrl' | 'rrm') operationsWithConstant;

RC: ('rcr' | 'rcl') operationWithTwoRegisters;
/***********************************************************************/

/************************************** Jump **************************************/
JumpOp: 
	('jz' | 'je' | 'jnz' | 'jne' | 'jc' | 'jbl' | 'jnc' | 'jae' | 'jmp' | 'jmpl')
	 (operationWithOffset | op=STRING);
//Ter isto desta forma ou partir aos bocados???
/********************************************************************************/

/******************************Type Operations****************************/
Immediate: register=Registers ',' immediate8=HexaDecimal;

Direct: register=Registers ',' direct7=HEX;

Indexed:
	rd=Registers ',''[' rbx=Registers ','index= '#' (INT | HEX) ']' ;
	
BasedIndexed: 
	Registers ',' '[' rbx=Registers ',' rix=Registers ']';

HexaDecimal: '#' number=HEX;

operationWithTwoRegisters: rd=Registers ',' rm=Registers;

operationsWithTreeRegisters: rd=Registers ',' rm=Registers ',' rn=Registers ;

operationsWithConstant: rd=Registers ',' rm=Registers ',' '#' const4=INT;

operationShift: rd=Registers ',' rm=Registers ',' '#' const4=INT ',' sin=INT;

operationWithOffset: rbx=Registers ',' offset8=HexaDecimal;
/***************************************************************************/

/***********************************************Utils**************************************/
Registers:
		value= ('r0' | 'r1' | 'r2' | 'r3' | 'r4' | 'r5' | 'r6' | 'r7' | 'PSW');

Number: STRING;
		//(INT | HEX | OCT | BIN);

terminal HEX : '0' ('x'|'X')(('0'..'9')|('a'..'f')|('A'..'F'))+;

terminal OCT : ('0' | '1'..'7' '0'..'7'*);

terminal BIN : ('0' | '1')+;

//terminal CONST4: ('0'..'9')+; //É IGUAL AO INT

terminal COMT : ';' -> '\n';
/******************************************************************************************/


